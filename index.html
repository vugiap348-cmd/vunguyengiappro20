<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Kiểm Tra Lịch Sử Số 19</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .timer {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 24px;
            font-weight: bold;
        }

        .timer.warning {
            background: rgba(255,0,0,0.3);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .content {
            padding: 30px;
        }

        .section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 30px 0 20px 0;
            font-size: 20px;
            font-weight: bold;
        }

        .question {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .options {
            margin-left: 20px;
        }

        .option {
            margin: 10px 0;
            display: flex;
            align-items: flex-start;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 10px;
            margin-top: 4px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .option label {
            cursor: pointer;
            flex: 1;
        }

        .document-box {
            background: #fff8dc;
            border: 2px solid #daa520;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-style: italic;
            line-height: 1.8;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result-box {
            background: #e8f5e9;
            border: 3px solid #4caf50;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            display: none;
        }

        .result-box.show {
            display: block;
        }

        .score {
            font-size: 32px;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            margin: 20px 0;
        }

        .correct {
            background: #c8e6c9 !important;
            border-left-color: #4caf50 !important;
        }

        .incorrect {
            background: #ffcdd2 !important;
            border-left-color: #f44336 !important;
        }

        .correct-answer {
            color: #2e7d32;
            font-weight: bold;
            margin-top: 10px;
        }

        .user-answer {
            color: #c62828;
            font-weight: bold;
            margin-top: 5px;
        }

        .instruction {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .part2-item {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #f0f0f0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ĐỀ KIỂM TRA SỐ 19 - MÔN LỊCH SỬ</h1>
            <div class="timer" id="timer">Thời gian: 45:00</div>
        </div>

        <div class="content">
            <div class="instruction">
                <strong>Hướng dẫn:</strong><br>
                - Phần I: Mỗi câu hỏi chỉ chọn một phương án (24 câu × 0.25 điểm = 6 điểm)<br>
                - Phần II: Mỗi câu có 4 ý a, b, c, d - chọn Đúng hoặc Sai (4 câu, thang điểm: 1 ý đúng = 0.1đ, 2 ý = 0.25đ, 3 ý = 0.5đ, 4 ý = 1.0đ)<br>
                - Thời gian làm bài: 45 phút<br>
                - Nhấn "Nộp bài" để xem kết quả và đáp án
            </div>

            <div class="section-title">PHẦN I: Thí sinh trả lời câu hỏi từ 1 đến 24. Mỗi câu hỏi thí sinh chỉ chọn một phương án.</div>
            
            <div id="part1-questions"></div>

            <div class="section-title">PHẦN II: Thí sinh trả lời câu hỏi từ 1 đến 4. Trong mỗi ý a), b), c), d) ở mỗi câu, thí sinh chọn đúng hoặc sai.</div>
            
            <div id="part2-questions"></div>

            <button class="submit-btn" id="submitBtn">Nộp bài</button>

            <div class="result-box" id="resultBox">
                <h2 style="text-align: center; color: #2e7d32;">KẾT QUẢ BÀI KIỂM TRA</h2>
                <div class="score" id="scoreDisplay"></div>
                <div id="detailScore"></div>
            </div>
        </div>
    </div>

    <script>
        const part1Questions = [
            {id: 1, question: "Đường lối cải cải cách mở của Trung Quốc được đề ra bởi nhân vật lịch sử nào sau đây?", options: ["Đặng Tiểu Bình.", "Mao Trạch Đông.", "Chu Ân Lai.", "Tập Cận Bình."], correct: 0},
            {id: 2, question: "Nguyên nhân nào sau đây quyết định sự thắng lợi của cách mạng dân tộc dân chủ Trung Quốc (1946 – 1949)?", options: ["Sự giúp đỡ của Mĩ đối với cách mạng Trung Quốc.", "Tình đoàn kết gắn bó với nhân dân Đông Dương.", "Sự ủng hộ, chi viện, giúp đỡ kịp thời của Việt Nam.", "Nhân dân trong nước ủng hộ lực lượng cách mạng."], correct: 3},
            {id: 3, question: "Cuộc khởi nghĩa do Phùng Hưng lãnh đạo (thế kỷ VIII) nhằm lật đổ ách thống trị của triều đại nào?", options: ["Hán.", "Đường.", "Tống.", "Nguyên."], correct: 1},
            {id: 4, question: "Nội dung nào sau đây là nguyên nhân dẫn đến sự thất bại của cuộc khởi nghĩa do Bà Triệu lãnh đạo?", options: ["Chênh lệch về tương quan lực lượng.", "Không được sự ủng hộ của nhân dân.", "Quý tộc người Việt chống đối, đàn áp.", "Điều kiện thời tiết quá khắc nghiệt."], correct: 0},
            {id: 5, question: "Một trong những quốc gia uỷ viên thường trực Hội đồng Bảo an Liên hợp quốc là", options: ["Nhật.", "Đức.", "Anh.", "Ấn."], correct: 2},
            {id: 6, question: "Một trong những nguyên nhân quốc tế khiến Mỹ và Liên Xô quyết định chấm dứt cuộc Chiến tranh lạnh (1947-1989) là gì?", options: ["Sự vươn lên mạnh mẽ của Nhật Bản, Tây Âu.", "Các nước Cộng hoà trong liên bang đòi ly khai.", "Nước Mỹ khủng hoảng kinh tế, chính trị sâu sắc.", "Nhân dân hai nước phản đối Chiến tranh lạnh."], correct: 0},
            {id: 7, question: "Sự thành lập Hiệp hội các quốc gia Đông Nam Á ( ASEAN) tháng 8-1967 có ý nghĩa", options: ["mở ra thời kỳ công nghiệp hóa đối với các nước trong khu vực.", "tăng cường quan hệ hữu nghị, hợp tác toàn diện giữa các nước.", "tăng cường hợp tác kinh tế, văn hoá giữa các nước thành viên.", "đánh dấu thời kỳ hội nhập của tất cả các nước trong khu vực."], correct: 2},
            {id: 8, question: "Từ khi trở thành \"ASEAN -10\" vào năm 1999, tổ chức này đẩy mạnh hoạt động hợp tác về", options: ["kinh tế.", "thể thao.", "quân sự.", "du lịch."], correct: 0},
            {id: 9, question: "Nội dung nào sau đây không phải là lí do để việc mở rộng thành viên của tổ chức ASEAN diễn ra lâu dài và đầy trở ngại?", options: ["Các quốc gia đã giành độc lập ở những thời điểm khác nhau.", "Chính sách chia để trị của các nước thực dân cũ đối với khu vực.", "Trình độ phát triển giữa các nước trong khu vực quá chênh lệch.", "Tác động của Chiến tranh lạnh và xoay quanh vấn đề Campuchia."], correct: 1},
            {id: 10, question: "Nội dung nào sau đây phản ánh đúng ý nghĩa của sự kiện vua Bảo Đại tuyên bố thoái vị ngày 30 tháng 8 năm 1945 đối với cách mạng Việt Nam?", options: ["Nhiệm vụ dân tộc của cách mạng đã hoàn thành.", "Nhiệm vụ dân chủ của cách mạng đã hoàn thành.", "Chế độ phong kiến ngàn năm ở Việt Nam sụp đổ.", "Tổng khởi nghĩa tháng Tám thắng lợi trên cả nước."], correct: 2},
            {id: 11, question: "Ngày 2-9-1945, tại Quảng trường Ba Đình (Hà Nội), Chủ tịch Hồ Chí Minh đã", options: ["đọc bản Tuyên ngôn Độc lập.", "phát lệnh Tổng khởi nghĩa.", "phát động Toàn dân kháng chiến.", "đọc Lời kêu gọi toàn quốc kháng chiến."], correct: 0},
            {id: 12, question: "Pháp mở cuộc tấn công quy mô lên căn cứ địa Việt Bắc (1947) với mục đích nào sau đây?", options: ["Kết thúc chiến tranh trong danh dự.", "Phá tan xứ Thái, xứ Mường tự trị.", "Tiêu diệt bộ đội chủ lực của Việt Nam.", "Thành lập Liên bang Đông Dương."], correct: 2},
            {id: 13, question: "Nội dung nào sau đây phản ánh đúng hạn chế cơ bản của tập đoàn cứ điểm Điện Biên Phủ ?", options: ["Chỉ có thể tiếp tế bằng đường không.", "Quá đông quân trong một địa bàn nhỏ.", "Không thể chi viện bằng không quân.", "Hỏa lực pháo binh của Pháp hạn chế."], correct: 0},
            {id: 14, question: "Nội dung nào sau đây không được đề cập trong đường lối Đổi mới của Đảng Cộng sản Việt Nam giai đoạn 1986 – 1995?", options: ["Đổi mới toàn diện hệ thống chính trị, đẩy mạnh công nghiệp hóa, hiện đại hóa.", "Đổi mới cơ cấu kinh tế, thực hiện xây dựng nền kinh tế hàng hóa nhiều thành phần.", "Xây dựng Nhà nước pháp quyền Việt Nam của nhân dân, do nhân dân, vì nhân dân.", "Mở rộng quan hệ với tất cả các nước trên cơ sở nguyên tắc cùng tồn tại hòa bình."], correct: 0},
            {id: 15, question: "Nội dung xuyên suốt trong chính sách đối ngoại của Việt Nam thời kì Đổi mới là", options: ["lấy đối ngoại song phương làm nền tảng.", "thực hiện chính sách ngoại giao cứng rắn.", "Việt Nam muốn làm bạn với tất cả các nước.", "phá vỡ sự bao vây, cấm vận của phương Tây."], correct: 2},
            {id: 16, question: "Quốc gia nào sau đây không có mối quan hệ đối tác chiến lược toàn diện với Việt Nam ?", options: ["Hàn Quốc.", "Nhật Bản.", "Cu-ba.", "Ấn Độ."], correct: 2},
            {id: 17, question: "Trong cuộc kháng chiến chống Mỹ, Đảng Lao động Việt Nam quyết định mở ra cục diện \"vừa đánh, vừa đàm\" từ thời điểm nào sau đây?", options: ["1965.", "1968.", "1973.", "1975."], correct: 1},
            {id: 18, question: "Nội dung nào sau đây là điểm giống nhau cơ bản giữa Hiệp định Giơnevơ (1954) và Hiệp định Pari (1973)?", options: ["Đều buộc các nước đế quốc chấm dứt chiến tranh xâm lược và rút hết quân về nước.", "Việt Nam sẽ thống nhất bằng cuộc tổng tuyển cử, có sự giám sát quốc tế sau hai năm.", "Các bên thừa nhận trên thực tế miền Nam Việt Nam có hai chính quyền, hai quân đội.", "Thỏa thuận các bên ngừng bắn thực hiện chuyển quân, tập kết, chuyển giao khu vực."], correct: 0},
            {id: 19, question: "Nguyễn Ái Quốc trở về Việt Nam trực tiếp lãnh đạo cách mạng trong thời gian nào sau đây?", options: ["Đầu năm 1941.", "Cuối năm 1941.", "Đầu năm 1942.", "Cuối năm 1942."], correct: 0},
            {id: 20, question: "Trong thời gian hoạt động cách mạng từ 1917 đến 1920, Nguyễn Ái Quốc không có đóng góp nào sau đây đối với cách mạng Việt Nam?", options: ["Chuẩn bị về tư tưởng chính trị cho sự thành lập Đảng.", "Từ người yêu nước trở thành người cộng sản đầu tiên.", "Tìm ra được con đường cứu nước phù hợp và đúng đắn.", "Truyền bá sâu rộng chủ nghĩa Mác – Lê-nin về nước."], correct: 3},
            {id: 21, question: "Nội dung nào sau đây phản ánh đúng quá trình lựa chọn con đường cứu nước của Nguyễn Ái Quốc trong giai đoạn 1911-1920?", options: ["Tìm hiểu và kiểm chứng để tìm ra đường lối cứu nước phù hợp.", "Tiếp thu và lựa chọn các khuynh hướng cứu nước đầu thế kỷ XX.", "Xung đột giữa tư tưởng cứu nước truyền thống và tư tưởng mới.", "Nhận thức đúng mối quan hệ giữa giải phóng dân tộc và giai cấp."], correct: 0},
            {id: 22, question: "Từ sự thất bại trong công cuộc cải tổ ở Liên Xô, Đảng Cộng sản Việt Nam đã rút ra được bài học kinh nghiệm nào sau đây để áp dụng trong công cuộc đổi mới ở Việt Nam?", options: ["Đổi mới toàn diện nhưng phải phù hợp với hoàn cảnh cụ thể của đất nước.", "Yếu tố quyết định của đổi mới là động lực và những nguồn lực từ bên ngoài.", "Lấy đổi mới chính trị là trọng tâm, xây dựng nền kinh tế hàng hóa tập trung.", "Đổi mới là kết hợp thực hiện đa nguyên về kinh tế với đa nguyên chính trị."], correct: 0},
            {id: 23, question: "Một trong những bài học kinh nghiệm quý báu rút ra từ chiến thắng Điện Biên Phủ (1954) có thể vận dụng trong sự nghiệp xây dựng và bảo vệ Tổ quốc Việt Nam hiện nay là", options: ["phát huy sức mạnh đại đoàn kết dân tộc trong mọi hoàn cảnh.", "giành thắng lợi quân sự mới giành được thắng lợi về ngoại giao.", "tập hợp đoàn kết toàn dân trên cơ sở liên minh công – nông.", "xây dựng lực lượng vũ trang nhân dân làm nhiệm vụ hàng đầu."], correct: 0},
            {id: 24, question: "Nhân tố nào sau đây đóng vai trò quyết định để các cường quốc tham gia xác lập trật tự thế giới mới sau Chiến tranh lạnh?", options: ["Sức mạnh tổng hợp của quốc gia, trong đó kinh tế vẫn là trụ cột.", "Là một trong năm cường quốc của Hội đồng Bảo an Liên hợp quốc.", "Sự ra đời và ngày càng mở rộng của các tổ chức liên kết khu vực.", "Sức mạnh quân sự của quốc gia với lực lượng quân sự hùng hậu."], correct: 0}
        ];

        const part2Questions = [
            {
                id: 1,
                question: "Cho những thông tin trong bảng sau đây:",
                document: '<table><tr><th>Thời gian</th><th>Sự kiện</th></tr><tr><td>Năm 1947</td><td>Quân Pháp tấn công lên Việt Bắc. Quân dân Việt Nam đã chủ động phản công và giành thắng lợi.</td></tr><tr><td>Năm 1950</td><td>Sau hơn một tháng mở chiến dịch Biên giới, quân dân Việt Nam đã giành thắng lợi buộc quân Pháp buộc phải rút khỏi đường số 4. Việt Nam giành được thế chủ động trên chiến trường chính Bắc Bộ.</td></tr><tr><td>Năm 1951</td><td>Đại hội đại biểu lần thứ II của Đảng Cộng sản Đông Dương họp tại Chiêm Hóa - Tuyên Quang.</td></tr><tr><td>Năm 1954</td><td>Thắng lợi của chiến dịch Điện Biên Phủ đã làm phá sản kế hoạch Nava của thực dân Pháp và tạo điều kiện thuận lợi cho cuộc đấu tranh ngoại giao giành thắng lợi tại Hội nghị Giơ-ne-vơ.</td></tr></table>',
                subQuestions: [
                    {id: 'a', text: "Tư liệu phản ánh những chiến thắng tiêu biểu của quân dân Việt Nam trong cuộc kháng chiến toàn quốc chống Pháp.", correct: true},
                    {id: 'b', text: "Các chiến dịch quân sự của quân dân Việt Nam đã phát huy thế chủ động về chiến lược trên chiến trường chính.", correct: false},
                    {id: 'c', text: "Đại hội đại biểu lần thứ hai của Đảng Cộng sản Đông Dương là cột mốc quan trọng trong xây dựng hậu phương kháng chiến.", correct: true},
                    {id: 'd', text: "Với chiến thắng Điện Biên Phủ 1954, cuộc kháng chiến toàn quốc chống Pháp của nhân dân Việt Nam đã kết thúc thắng lợi.", correct: false}
                ]
            },
            {
                id: 2,
                question: "Cho đoạn tư liệu sau đây:",
                document: '"Cơ cấu nông nghiệp và kinh tế nông thôn đã có bước chuyển biến tích cực theo hướng đẩy mạnh sản xuất các loại nông sản hàng hóa có nhu cầu thị trường và có giá trị kinh tế cao. Cơ cấu các ngành kinh tế từng bước chuyển dịch theo hướng công nghiệp hóa, hiện đại hóa. Tỷ trọng nông, lâm, ngư nghiệp trong GDP giảm dần. Cơ cấu kinh tế nông thôn chuyển dịch theo hướng tăng nhanh dần tỷ trọng các ngành phi nông nghiệp (công nghiệp, nghề thủ công, dịch vụ), giảm tỷ trọng nông nghiệp."<br><em>Nguyễn Ngọc Mão (Chủ biên), Lịch sử Việt Nam, tập 15, NXB. Khoa học xã hội 2017, tr. 283</em>',
                subQuestions: [
                    {id: 'a', text: "Tư liệu đề cập đến một trong những thành tựu của công cuộc đổi mới đất nước ở Việt Nam từ sau năm 1986.", correct: true},
                    {id: 'b', text: "Sau năm 1986, Việt Nam đã xây dựng được cơ cấu các ngành kinh tế hiện đại hoạt động theo cơ chế thị trường.", correct: false},
                    {id: 'c', text: "Kinh tế được xác định là trọng tâm của công cuộc đổi mới, chú trọng xây dựng nền kinh tế thị trường có điều tiết.", correct: true},
                    {id: 'd', text: "Trong đổi mới kinh tế, Việt Nam chủ trương hạn chế nông nghiệp để phát triển công nghiệp, thủ công nghiệp, dịch vụ.", correct: false}
                ]
            },
            {
                id: 3,
                question: "Cho đoạn tư liệu sau đây:",
                document: '"Ngày 5-9-1954, nghị quyết của Bộ Chính trị "Về tình hình mới, nhiệm vụ mới và chính sách của Đảng" đã đề ra những nét lớn về công tác ngoại giao. Theo đó, chính sách ngoại giao trong giai đoạn mới được xác định: "Chính sách ngoại giao của ta là xây dựng và phát triển quan hệ ngoại giao với bất cứ nước nào dựa theo nguyên tắc bình đẳng, hai bên đều có lợi và tôn trọng lãnh thổ, chủ quyền của nhau. Phương châm chính sách ngoại giao của ta là chống chính sách chiến tranh của đế quốc Mỹ, chống Mỹ tổ chức khối xâm lược Đông Nam Á, củng cố hòa bình ở Đông Dương và bảo vệ hòa bình Đông Nam Á và toàn thế giới".<br><em>Phạm Đức Thuận: Giáo trình Lịch sử ngoại giao Việt Nam, NXB Đại học Cần Thơ, 2018, tr 125</em>',
                subQuestions: [
                    {id: 'a', text: "Tư liệu đề cập đến chính sách ngoại giao của Việt Nam trong giai đoạn cuối của cuộc kháng chiến chống Pháp.", correct: false},
                    {id: 'b', text: "Trong cuộc kháng chiến chống Mỹ, ngoại giao Việt Nam đã phát triển trở thành một mặt trận trực tiếp đánh địch.", correct: true},
                    {id: 'c', text: "Mặt trận ngoại giao có vai trò quyết định đối với sự phát triển của chiến tranh giải phóng dân tộc và bảo vệ tổ quốc.", correct: false},
                    {id: 'd', text: "Chính sách ngoại giao của Việt Nam giai đoạn 1954 – 1975 đã đóng góp tích cực cho hòa bình, an ninh thế giới.", correct: true}
                ]
            },
            {
                id: 4,
                question: "Cho đoạn tư liệu sau đây:",
                document: '"Trật tự thế giới mới đang dần dần hình thành, tương lai của trật tự mới này đang phụ thuộc vào các nhân tố: lực lượng so sánh giữa các nước lớn Mĩ, Nga (thay Liên Xô cũ), Trung Quốc, Nhật Bản, Đức, Anh, Pháp và mối quan hệ giữa các nước lớn này với nhau; sự phát triển của lực lượng cách mạng thế giới (công cuộc cải cách và đổi mới của các nước xã hội chủ nghĩa, phong trào cộng sản và công nhân quốc tế, phong trào đấu tranh vì hoà bình, dân chủ và tiến bộ xã hội); sự vươn lên của các nước mới giành được độc lập dân tộc ở Á, Phi, Mĩ latinh; sự phát triển của cách mạng khoa học-kĩ thuật sẽ tác động quan trọng tới trật tự mới này."<br><em>Nguyễn Anh Thái: Lịch sử thế giới hiện đại (1917 - 1995), NXB Giáo dục Việt Nam, Hà Nội, 2006, tr 543</em>',
                subQuestions: [
                    {id: 'a', text: "Tư liệu đề cập đến sự hình thành và phát triển của trật tự thế giới mới sau khi Chiến tranh lạnh chấm dứt.", correct: true},
                    {id: 'b', text: "Trong trật tự thế giới mới sau Chiến tranh lạnh, phong trào giải phóng dân tộc tiếp tục đóng vai trò quan trọng.", correct: false},
                    {id: 'c', text: "Sau Chiến tranh lạnh, do tương quan lực lượng giữa các cường quốc, Mỹ không thể định hình thế giới theo ý mình.", correct: true},
                    {id: 'd', text: "Cuộc cách mạng khoa học kỹ thuật sẽ tiếp tục là nhân tố đột phá, chi phối, định hình trật tự thế giới mới.", correct: false}
                ]
            }
        ];

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        const shuffledPart1 = part1Questions.map(q => {
            const shuffledOptions = shuffleArray(q.options.map((opt, idx) => ({text: opt, isCorrect: idx === q.correct})));
            return {...q, options: shuffledOptions.map(o => o.text), correct: shuffledOptions.findIndex(o => o.isCorrect)};
        });

        const shuffledPart2 = part2Questions.map(q => ({...q, subQuestions: shuffleArray(q.subQuestions)}));

        function renderPart1() {
            const container = document.getElementById('part1-questions');
            shuffledPart1.forEach(q => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.id = 'p1q' + q.id;
                let html = '<div class="question-title">Câu ' + q.id + '. ' + q.question + '</div><div class="options">';
                q.options.forEach((option, optIndex) => {
                    const letter = String.fromCharCode(65 + optIndex);
                    html += '<div class="option"><input type="radio" name="q' + q.id + '" id="q' + q.id + '_' + optIndex + '" value="' + optIndex + '"><label for="q' + q.id + '_' + optIndex + '">' + letter + '. ' + option + '</label></div>';
                });
                html += '</div>';
                questionDiv.innerHTML = html;
                container.appendChild(questionDiv);
            });
        }

        function renderPart2() {
            const container = document.getElementById('part2-questions');
            shuffledPart2.forEach(q => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.id = 'p2q' + q.id;
                let html = '<div class="question-title">Câu ' + q.id + ': ' + q.question + '</div>';
                html += '<div class="document-box">' + q.document + '</div>';
                q.subQuestions.forEach(sub => {
                    html += '<div class="part2-item"><strong>' + sub.id + ')</strong> ' + sub.text + '<br><div style="margin-top: 8px; margin-left: 20px;"><label style="margin-right: 20px;"><input type="radio" name="q' + q.id + '_' + sub.id + '" value="true"> Đúng</label><label><input type="radio" name="q' + q.id + '_' + sub.id + '" value="false"> Sai</label></div></div>';
                });
                questionDiv.innerHTML = html;
                container.appendChild(questionDiv);
            });
        }

        let timeLeft = 45 * 60;
        const timerElement = document.getElementById('timer');
        
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = 'Thời gian: ' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            if (timeLeft <= 5 * 60) timerElement.classList.add('warning');
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitExam();
            }
            timeLeft--;
        }
        
        const timerInterval = setInterval(updateTimer, 1000);

        function gradeExam() {
            let part1Score = 0, part2Score = 0;
            const results = {part1: [], part2: []};
            
            shuffledPart1.forEach(q => {
                const selected = document.querySelector('input[name="q' + q.id + '"]:checked');
                const userAnswer = selected ? parseInt(selected.value) : -1;
                const isCorrect = userAnswer === q.correct;
                if (isCorrect) part1Score += 0.25;
                results.part1.push({id: q.id, correct: isCorrect, userAnswer: userAnswer, correctAnswer: q.correct});
            });
            
            shuffledPart2.forEach(q => {
                let correctCount = 0;
                const subResults = [];
                q.subQuestions.forEach(sub => {
                    const selected = document.querySelector('input[name="q' + q.id + '_' + sub.id + '"]:checked');
                    const userAnswer = selected ? selected.value === 'true' : null;
                    const isCorrect = userAnswer === sub.correct;
                    if (isCorrect) correctCount++;
                    subResults.push({id: sub.id, correct: isCorrect, userAnswer: userAnswer, correctAnswer: sub.correct});
                });
                if (correctCount === 1) part2Score += 0.1;
                else if (correctCount === 2) part2Score += 0.25;
                else if (correctCount === 3) part2Score += 0.5;
                else if (correctCount === 4) part2Score += 1.0;
                results.part2.push({id: q.id, correctCount: correctCount, subResults: subResults});
            });
            
            return {
                part1Score: Math.round(part1Score * 100) / 100,
                part2Score: Math.round(part2Score * 100) / 100,
                totalScore: Math.round((part1Score + part2Score) * 100) / 100,
                results: results
            };
        }

        function displayResults(gradeResults) {
            const resultBox = document.getElementById('resultBox');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const detailScore = document.getElementById('detailScore');
            
            scoreDisplay.innerHTML = 'Tổng điểm: ' + gradeResults.totalScore + '/10';
            detailScore.innerHTML = '<p style="text-align: center; font-size: 18px;">Phần I: ' + gradeResults.part1Score + '/6 điểm<br>Phần II: ' + gradeResults.part2Score + '/4 điểm</p>';
            resultBox.classList.add('show');
            
            gradeResults.results.part1.forEach(r => {
                const questionDiv = document.getElementById('p1q' + r.id);
                questionDiv.classList.add(r.correct ? 'correct' : 'incorrect');
                if (!r.correct) {
                    const correctLetter = String.fromCharCode(65 + r.correctAnswer);
                    const userLetter = r.userAnswer >= 0 ? String.fromCharCode(65 + r.userAnswer) : 'Không chọn';
                    const answerInfo = document.createElement('div');
                    answerInfo.innerHTML = '<div class="user-answer">Bạn chọn: ' + userLetter + '</div><div class="correct-answer">Đáp án đúng: ' + correctLetter + '</div>';
                    questionDiv.appendChild(answerInfo);
                }
            });
            
            gradeResults.results.part2.forEach(r => {
                const questionDiv = document.getElementById('p2q' + r.id);
                questionDiv.classList.add(r.correctCount === 4 ? 'correct' : 'incorrect');
                const answerInfo = document.createElement('div');
                answerInfo.innerHTML = '<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;"><strong>Kết quả: ' + r.correctCount + '/4 ý đúng</strong><br>';
                r.subResults.forEach(sub => {
                    const icon = sub.correct ? '✓' : '✗';
                    const color = sub.correct ? '#2e7d32' : '#c62828';
                    const userText = sub.userAnswer === null ? 'Không chọn' : (sub.userAnswer ? 'Đúng' : 'Sai');
                    const correctText = sub.correctAnswer ? 'Đúng' : 'Sai';
                    answerInfo.innerHTML += '<div style="margin: 5px 0; color: ' + color + ';">' + icon + ' <strong>' + sub.id + ')</strong> Bạn chọn: <strong>' + userText + '</strong> - Đáp án: <strong>' + correctText + '</strong></div>';
                });
                answerInfo.innerHTML += '</div>';
                questionDiv.appendChild(answerInfo);
            });
        }

        function submitExam() {
            clearInterval(timerInterval);
            document.getElementById('submitBtn').disabled = true;
            document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = true;
            });
            const gradeResults = gradeExam();
            displayResults(gradeResults);
            document.getElementById('resultBox').scrollIntoView({behavior: 'smooth'});
        }

        document.getElementById('submitBtn').addEventListener('click', submitExam);
        renderPart1();
        renderPart2();
        updateTimer();
    </script>
</body>
  </html>
